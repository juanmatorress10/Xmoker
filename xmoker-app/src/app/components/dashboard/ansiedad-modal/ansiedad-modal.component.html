<div class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center"
     style="background-color: rgba(0, 0, 0, 0.6); z-index: 1050;">
  <div class="p-4 rounded-4 shadow-lg w-100"
       [ngClass]="claseDeFondo"
       style="max-width: 500px; max-height: 90vh; overflow-y: auto;">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="fw-bold text-primary m-0">ğŸ§˜â€â™€ï¸ Gestionar Ansiedad</h4>
      <button class="btn-close" (click)="cerrar()"></button>
    </div>

        <!-- MENÃš PRINCIPAL -->
    <div *ngIf="seccionActiva === 'inicio'" class="d-grid gap-2">
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('respiracion')">ğŸŒ¬ï¸ RespiraciÃ³n guiada</button>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('sonidos')">ğŸ§ Sonidos relajantes</button>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('juegos')">ğŸ§  Mini Juegos mentales</button>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('motivacion')">ğŸ’¬ Recordar mis motivaciones</button>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('fisico')">ğŸƒâ€â™€ï¸ Estiramiento rÃ¡pido</button>
    </div>


        <!-- SUBMENÃš: SONIDOS RELAJANTES -->
    <div *ngIf="seccionActiva === 'sonidos'" class="d-grid gap-2 text-center">
      <h5 class="text-primary fw-semibold mb-3">Elige una escena sonora:</h5>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('sonido-mar')">ğŸŒŠ Sonido del mar</button>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('sonido-lluvia')">ğŸŒ§ï¸ Sonido de lluvia</button>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('sonido-bosque')">ğŸŒ² Sonido del bosque</button>
    </div>

        <!-- SUBMENÃš: JUEGOS MENTALES -->
    <div *ngIf="seccionActiva === 'juegos'" class="d-grid gap-2 text-center">
      <h5 class="text-primary fw-semibold mb-3">Elige un reto mental:</h5>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('juego-cuenta')">ğŸ”¢ Cuenta regresiva</button>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('juego-emojis')">ğŸ§ Encuentra el emoji diferente</button>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('juego-stroop')">ğŸ”´ Color vs palabra</button>
      <button class="btn btn-outline-primary" (click)="cambiarSeccion('juego-memoria')">ğŸ§  Memoria rÃ¡pida</button>
    </div>



    <!-- RESPIRACIÃ“N GUIADA -->
    <div *ngIf="seccionActiva === 'respiracion'" class="text-center">
      <p class="text-muted fst-italic">
        Esta tÃ©cnica te ayudarÃ¡ a recuperar el control de tu respiraciÃ³n y calmar la ansiedad. Respira con calma, sin forzar.
      </p>
      <p class="fw-bold text-primary mt-3">{{ mensajeRespiracion }}</p>
      <div class="d-flex justify-content-center align-items-center my-4" style="height: 140px;">
        <div class="circulo-animado" [ngClass]="estadoAnimacion"></div>
      </div>
      <p class="text-secondary small mb-2">Ciclo {{ ciclosRespiracion + 1 }}/3</p>
      <div class="progress rounded-5 mx-auto" style="height: 10px; max-width: 300px;">
        <div class="progress-bar" [style.width.%]="((ciclosRespiracion) / 3) * 100"
             style="transition: width 0.5s ease;" role="progressbar"></div>
      </div>
      <div *ngIf="!enRespiracion && !respiracionFinalizada" class="mt-4">
        <button class="btn btn-primary" (click)="iniciarRespiracion()">â–¶ Empezar</button>
      </div>
      <div *ngIf="respiracionFinalizada" class="mt-4">
        <p class="text-success fw-semibold">Â¡RespiraciÃ³n completada! ğŸŒ¬ï¸</p>
        <button class="btn btn-success" (click)="registrarAccion('respiracion')">âœ” Me siento mejor</button>
      </div>
    </div>

    <!-- ESCENA: SONIDO DEL MAR -->
    <app-escena-relajante
      *ngIf="seccionActiva === 'sonido-mar'"
      [titulo]="'ğŸŒŠ RelajaciÃ³n en la playa'"
      [textoGuiado]="[
        'EstÃ¡s en la orilla de una playa tranquila.',
        'Siente la brisa del mar acariciar tu rostroâ€¦',
        'Las olas rompen con suavidad frente a ti, marcando un ritmo sereno.',
        'Con cada respiraciÃ³n, te sientes mÃ¡s ligero...',
        'Cierra los ojos unos segundosâ€¦ imagina que estÃ¡s allÃ­.'
      ]"

      audioSrc="audios/mar.mp3"
      tipoRegistro="sonido-mar"
      [onRegistrar]="registrarSonidoMar"
    />

    <!-- ESCENA: SONIDO DE LLUVIA -->
    <app-escena-relajante
      *ngIf="seccionActiva === 'sonido-lluvia'"
      [titulo]="'ğŸŒ§ï¸ Bajo la lluvia'"
      [textoGuiado]="[
        'Te encuentras bajo un tejado de madera, mirando la lluvia caer.',
        'Cada gota que golpea el suelo marca un compÃ¡s suave.',
        'El olor a tierra mojada te conecta con la calma.',
        'La lluvia limpia tus pensamientos y alivia la tensiÃ³n.',
        'Cierra los ojos unos segundosâ€¦ imagina que estÃ¡s allÃ­.'
      ]"
      audioSrc="audios/lluvia.mp3"
      tipoRegistro="sonido-lluvia"
      [onRegistrar]="registrarSonidoLluvia"
    />

    <!-- ESCENA: BOSQUE -->
    <app-escena-relajante
      *ngIf="seccionActiva === 'sonido-bosque'"
      [titulo]="'ğŸŒ² Paseo por el bosque'"
      [textoGuiado]="[
        'Caminas por un sendero cubierto de hojas suaves.',
        'Los Ã¡rboles te rodean, altos y tranquilos.',
        'El canto de los pÃ¡jaros acompaÃ±a cada paso.',
        'Sientes la paz de estar en contacto con la naturaleza.',
        'Cierra los ojos unos segundosâ€¦ imagina que estÃ¡s allÃ­.'
      ]"
      audioSrc="audios/bosque.mp3"
      tipoRegistro="sonido-bosque"
      [onRegistrar]="registrarSonidoBosque"
    />

  <!-- JUEGO 1: CUENTA REGRESIVA DINÃMICA -->
  <div *ngIf="seccionActiva === 'juego-cuenta'" class="text-center">
    <p class="fw-bold text-primary mt-3">Empieza desde <strong>{{ contador }}</strong>. Resta de 7 en 7:</p>
    <div *ngIf="!enProgreso" class="mt-3">
      <button class="btn btn-primary" (click)="iniciarCuentaRegresiva()">â–¶ Empezar</button>
    </div>
    <div *ngIf="enProgreso" class="mt-3">
      <button class="btn btn-danger" (click)="detenerCuentaRegresiva()">â¹ Detener</button>
    </div>
    <div *ngIf="terminado" class="mt-3">
      <p class="text-success">Â¡Bien hecho!</p>
      <button class="btn btn-success" (click)="registrarAccion('juego-cuenta')">âœ” Terminado</button>
    </div>
  </div>

  <!-- JUEGO 2: EMOJI DIFERENTE -->
  <div *ngIf="seccionActiva === 'juego-emojis'" class="text-center">
    <p class="fw-bold text-primary mb-2">ğŸ§  Nivel {{ nivelEmoji }}: Encuentra el emoji diferente</p>

    <div class="d-flex flex-wrap justify-content-center gap-2">
      <button class="btn btn-light" *ngFor="let emoji of emojis; let i = index" (click)="seleccionarEmoji(i)">
        {{ emoji }}
      </button>
    </div>

    <div *ngIf="respuestaEmoji !== null" class="mt-3">
      <p [ngClass]="{ 'text-success': respuestaEmoji, 'text-danger': !respuestaEmoji }">
        {{ respuestaEmoji ? 'Â¡Correcto! Subiendo dificultad...' : 'Intenta otra vez ğŸ˜…' }}
      </p>
      <button class="btn btn-outline-primary mt-2" (click)="resetEmoji()">ğŸ” Nueva ronda</button>
      <button class="btn btn-success mt-2 ms-2" (click)="registrarAccion('juego-emojis')">âœ” Terminar juego</button>
    </div>
  </div>


  <!-- JUEGO 3: STROOP COLOR VS PALABRA -->
  <div *ngIf="seccionActiva === 'juego-stroop'" class="text-center">
    <p class="fw-bold text-primary mb-2">ğŸ¯ Nivel {{ nivelStroop }}: Â¿De quÃ© color es esta palabra?</p>
    <h2 [style.color]="colorActual" class="fw-bold my-3">{{ palabraActual }}</h2>

    <div class="d-flex flex-wrap justify-content-center gap-2">
      <button
        *ngFor="let color of colores.slice(0, nivelStroop + 2)"
        class="btn"
        [ngClass]="{
          'btn-outline-danger': color === 'red',
          'btn-outline-primary': color === 'blue',
          'btn-outline-success': color === 'green',
          'btn-outline-warning': color === 'yellow',
          'btn-outline-secondary': color === 'purple',
          'btn-outline-pink': color === 'deeppink'
        }"
        (click)="seleccionarColor(color)">
        {{ color | titlecase }}
      </button>
    </div>

    <div *ngIf="resultadoStroop !== null" class="mt-3">
      <p [ngClass]="{ 'text-success': resultadoStroop, 'text-danger': !resultadoStroop }">
        {{ resultadoStroop ? 'Â¡Correcto!' : 'Incorrecto ğŸ˜…' }}
      </p>
      <button class="btn btn-outline-primary mt-2" (click)="continuarStroop()">ğŸ” Otra</button>
      <button class="btn btn-success mt-2 ms-2" (click)="registrarAccion('juego-stroop')">âœ” Terminar juego</button>
    </div>
  </div>


  <!-- JUEGO 4: MEMORIA RÃPIDA -->
<div *ngIf="seccionActiva === 'juego-memoria'" class="text-center">
  <p class="fw-bold text-primary">Recuerda estos emojis:</p>

  <div *ngIf="!mostrarOpciones">
    <div class="fs-3">{{ emojisMemoria.join(' ') }}</div>
    <p class="text-muted mt-2">Tiempo restante: {{ tiempoRestanteMemoria }}s</p>
    <div class="progress mx-auto" style="max-width: 300px; height: 10px;">
      <div class="progress-bar" [style.width.%]="(tiempoRestanteMemoria / 4) * 100"></div>
    </div>
  </div>

  <div *ngIf="mostrarOpciones">
    <p class="mt-3">Â¿CuÃ¡l de estos <strong>NO</strong> estaba?</p>
    <div class="d-flex justify-content-center gap-2">
      <button class="btn btn-light" *ngFor="let opcion of opcionesMemoria" (click)="seleccionarMemoria(opcion)">
        {{ opcion }}
      </button>
    </div>
  </div>

  <div *ngIf="resultadoMemoria !== null" class="mt-3">
    <p [ngClass]="{ 'text-success': resultadoMemoria, 'text-danger': !resultadoMemoria }">
      {{ resultadoMemoria ? 'Â¡Bien recordado!' : 'No exactamente. Intenta otra vez.' }}
    </p>
    <button class="btn btn-outline-primary mt-2" (click)="generarMemoria()">ğŸ” Reintentar</button>
    <button class="btn btn-success mt-2 ms-2" (click)="registrarAccion('juego-memoria')">âœ” Terminado</button>
  </div>
</div>


<!-- SECCIÃ“N: MOTIVACIÃ“N -->
<div *ngIf="seccionActiva === 'motivacion'" class="text-center space-y-4">
  <h2 class="text-xl font-bold text-blue-600">Tus motivos, tu fuerza ğŸ’™</h2>
  <p class="text-sm text-gray-500">
    A veces olvidar es humano, por eso estamos aquÃ­ para recordarte por quÃ© empezaste este camino.
  </p>

  <ul class="text-left text-gray-700 list-disc pl-6 space-y-1" *ngIf="motivacionesUsuario.length > 0; else sinMotivaciones">
    <li *ngFor="let motivo of motivacionesUsuario">
      {{ motivo }}
    </li>
  </ul>

  <ng-template #sinMotivaciones>
    <p class="text-gray-400 italic">
      AÃºn no has aÃ±adido tus motivaciones. Puedes hacerlo desde tu perfil cuando estÃ©s listo âœ¨
    </p>
  </ng-template>

  <button class="btn btn-success mt-4" (click)="registrarAccion('motivacion')">
    ğŸ’ª Gracias por recordÃ¡rmelo
  </button>
</div>



    <!-- SECCIÃ“N: FÃSICO -->
<div *ngIf="seccionActiva === 'fisico'" class="text-center space-y-4">
  <h2 class="text-xl font-bold text-blue-600">Momento para tu cuerpo ğŸ’ª</h2>
  <p class="text-gray-600 text-sm">Te proponemos un pequeÃ±o reinicio fÃ­sico. Hazlo a tu ritmo:</p>

  <ul class="text-left text-gray-700 list-disc pl-6 max-w-md mx-auto space-y-1 text-sm">
    <li>LevÃ¡ntate despacio y respira profundo 3 veces.</li>
    <li>Da una vuelta corta o camina 10 pasos.</li>
    <li>Estira cuello (de lado a lado) y hombros.</li>
    <li>Relaja las manos y sacude brazos suavemente.</li>
    <li>SonrÃ­e, aunque sea un poco ğŸ™‚</li>
  </ul>

  <p class="text-gray-500 text-xs">Mover el cuerpo rompe el ciclo de tensiÃ³n. Bien hecho.</p>

  <button class="btn btn-success" (click)="registrarAccion('fisico')">ğŸƒ Â¡Listo, me siento mejor!</button>
</div>

    <!-- BOTÃ“N VOLVER -->
    <div *ngIf="seccionActiva !== 'inicio'" class="text-center mt-4">
      <button class="btn btn-outline-secondary btn-sm" (click)="cambiarSeccion('inicio')">â¬… Volver</button>
    </div>

  </div>
</div>
